---
title: Reverse geocoding from coordinate to ZCTA in R
author: Ran Li
date: '2021-07-23'
slug: reverse-geocoding-from-coordinate-to-zcta-in-r
categories: []
tags: []
subtitle: ''
summary: ''
authors: []
lastmod: '2021-07-23T10:05:05-04:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
editor_options: 
  chunk_output_type: console
---

<script src="{{< blogdown/postref >}}index.en_files/htmlwidgets/htmlwidgets.js"></script>
<script src="{{< blogdown/postref >}}index.en_files/jquery/jquery.min.js"></script>
<link href="{{< blogdown/postref >}}index.en_files/leaflet/leaflet.css" rel="stylesheet" />
<script src="{{< blogdown/postref >}}index.en_files/leaflet/leaflet.js"></script>
<link href="{{< blogdown/postref >}}index.en_files/leafletfix/leafletfix.css" rel="stylesheet" />
<script src="{{< blogdown/postref >}}index.en_files/proj4/proj4.min.js"></script>
<script src="{{< blogdown/postref >}}index.en_files/Proj4Leaflet/proj4leaflet.js"></script>
<link href="{{< blogdown/postref >}}index.en_files/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
<script src="{{< blogdown/postref >}}index.en_files/leaflet-binding/leaflet.js"></script>


<p>Goal: Starting with a list of coordinates (lng and lat) we want to find which ZCTA they belong to.</p>
<p>Data required:
- table of coordinates
- ZCTA boundaries/shape files: You can find the most shape files for US geographic units at the <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html">US Census Bureau website</a>, the specific link for ZCTA files are. <a href="https://www2.census.gov/geo/tiger/TIGER2019/ZCTA5/">here</a>.</p>
<p>Libraries require:
- tidyverse: for data management with dplr and functional programming tools with purrr.
- sf: working with <a href="https://r-spatial.github.io/sf/">simple features</a>.
- rgdal: for reading shape files.</p>
<div id="step-1-prepare-your-data" class="section level1">
<h1>Step 1: Prepare your data</h1>
<p>The code below loads libraries and the data required. Note for this example we providing a minumum example looking at ZCTAs in Philadelphia. We first get some coordinates by taking the centroid of the ZCTA and taking a sample of 5 ZCTA cetrnoids; these will be used for reverse geocoding. The answer is stored in the column ‘zcta_origin’. You will probably have some coordinates already in hand… so just use your table here.</p>
<pre class="r"><code>### Loadl libraries
library(tidyverse)
library(sf)
library(rgdal)
library(purrr)


### Read in ZCTA shape files
sf_zcta_philly = readOGR(&quot;Census ZCTA Shape Files/tl_2019_us_zcta510.shp&quot;) %&gt;%
  st_as_sf()   %&gt;% 
  mutate(zcta = ZCTA5CE10 ) %&gt;% 
  left_join(xwalk_zcta_bchc) %&gt;% 
  filter(city == &quot;Philadelphia&quot;)

### Get centroids/coords for us to do reverse geocoding. 
df_coord = sf_zcta_philly %&gt;% 
  st_centroid() %&gt;% 
  st_coordinates() %&gt;% 
  as_tibble() %&gt;% 
  mutate(zcta_origin = sf_zcta_philly$zcta ) %&gt;% 
  sample_n(5) %&gt;% 
  mutate(id = row_number()) %&gt;% 
  select(id, longitude=X,  latitude = Y,zcta_origin)  </code></pre>
<p>The table of coordinates we are work with looks like this… just five rows for this example.</p>
<table>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="right">longitude</th>
<th align="right">latitude</th>
<th align="left">zcta_origin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">-75.25625</td>
<td align="right">39.97559</td>
<td align="left">19151</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">-75.14570</td>
<td align="right">39.96408</td>
<td align="left">19123</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">-75.17400</td>
<td align="right">39.95283</td>
<td align="left">19103</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">-75.01883</td>
<td align="right">40.03973</td>
<td align="left">19136</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">-75.22701</td>
<td align="right">40.02814</td>
<td align="left">19127</td>
</tr>
</tbody>
</table>
</div>
<div id="step-2-function-to-find-out-which-zcta-they-intersect-with" class="section level1">
<h1>Step 2: Function to find out which ZCTA they intersect with</h1>
<p>Lets first write some code to see which ZCTA a coordinate pair intersects with.</p>
<pre class="r"><code>### Lets take the first row and make a  point object
lng_tmp = df_coord %&gt;% slice(1) %&gt;% pull(longitude)
lat_tmp = df_coord %&gt;% slice(1) %&gt;% pull(latitude)
zcta_origin_tmp = df_coord %&gt;% slice(1) %&gt;% pull(zcta_origin)
pt_tmp = st_point(x = c(lng_tmp, lat_tmp), dim = &quot;XYZ&quot;)

### see which polygon/row of sf_zcta_philly this point intersects with
intersection_row_tmp = st_intersects(pt_tmp,sf_zcta_philly)[[1]]
sf_zcta_tmp = sf_zcta_philly %&gt;% slice(intersection_row_tmp)
zcta_tmp = sf_zcta_tmp$ZCTA5CE10

### Lets check by plotting the starting coordinate and the ZCTA we matched
leaflet() %&gt;% 
  addTiles() %&gt;% 
  addMarkers(lng = lng_tmp, lat = lat_tmp,  
             label = glue(&quot;ZCTA_origin: {zcta_origin_tmp}&lt;/br&gt;Coord: ({round(lng_tmp,2)}, {round(lat_tmp,2)})&quot;) %&gt;% HTML(),
             labelOptions = labelOptions(noHide = T, direction = &quot;bottom&quot;)) %&gt;% 
  addPolygons(data = sf_zcta_tmp, label = paste(&quot;ZCTA:&quot;,zcta_tmp))</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addMarkers","args":[39.9755909620883,-75.2562514409828,null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null,null,"ZCTA_origin: 19151<\/br>Coord: (-75.26, 39.98)",{"interactive":false,"permanent":true,"direction":"bottom","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolygons","args":[[[[{"lng":[-75.280266,-75.27951,-75.279137,-75.278938,-75.278186,-75.277669,-75.276482,-75.276131,-75.275871,-75.275468,-75.275284,-75.273552,-75.273154,-75.273026,-75.272255,-75.27153,-75.271309,-75.269257,-75.267973,-75.267398,-75.26725,-75.266251,-75.265566,-75.265511,-75.264748,-75.264386,-75.264351,-75.263687,-75.262946,-75.262794,-75.262512,-75.26078,-75.260689,-75.259476,-75.259284,-75.258842,-75.258705,-75.258545,-75.25695,-75.256874,-75.256287,-75.256119,-75.255676,-75.253999,-75.2516,-75.251546,-75.251438,-75.250786,-75.250336,-75.25013,-75.25,-75.249925,-75.248618,-75.247992,-75.247774,-75.247554,-75.247332,-75.247101,-75.246865,-75.246609,-75.24644,-75.246349,-75.245833,-75.245574,-75.245313,-75.245047,-75.244774,-75.244497,-75.244214,-75.243927,-75.243635,-75.24334,-75.243043,-75.242741,-75.242436,-75.24213,-75.241824,-75.241209,-75.24059,-75.239347,-75.239038,-75.238612,-75.238744,-75.239042,-75.239335,-75.239417,-75.239473,-75.239467,-75.239379,-75.239302,-75.239258,-75.239189,-75.239124,-75.23905,-75.239006,-75.238891,-75.238844,-75.238792,-75.238689,-75.23857,-75.238277,-75.237983,-75.237741,-75.237455,-75.237406,-75.237293,-75.23724,-75.237283,-75.237502,-75.238021,-75.238191,-75.238489,-75.23879,-75.239479,-75.240464,-75.241452,-75.242123,-75.242755,-75.243427,-75.244416,-75.245473,-75.246531,-75.247518,-75.247627,-75.248615,-75.248507,-75.249495,-75.249579,-75.249991,-75.250481,-75.250801,-75.250828,-75.250918,-75.250985,-75.251119,-75.250935,-75.250601,-75.250397,-75.250218,-75.250133,-75.249291,-75.248752,-75.248157,-75.247169,-75.247464,-75.247463,-75.247446,-75.247399,-75.247308,-75.247208,-75.247109,-75.247003,-75.246863,-75.246425,-75.246682,-75.246753,-75.247194,-75.247613,-75.247688,-75.247642,-75.247604,-75.247489,-75.247418,-75.247399,-75.247405,-75.247434,-75.247479,-75.247564,-75.247685,-75.247778,-75.247903,-75.248056,-75.248615,-75.248967,-75.249465,-75.249728,-75.249848,-75.249912,-75.24999,-75.250054,-75.250133,-75.250221,-75.250313,-75.250447,-75.250606,-75.250757,-75.250913,-75.251048,-75.251102,-75.251201,-75.251283,-75.251342,-75.251336,-75.251341,-75.251353,-75.251368,-75.251427,-75.251496,-75.251603,-75.251707,-75.251811,-75.251923,-75.252094,-75.252334,-75.252636,-75.252843,-75.252972,-75.253077,-75.253222,-75.253314,-75.253407,-75.253582,-75.253712,-75.253936,-75.254046,-75.25414,-75.254223,-75.254302,-75.254337,-75.254381,-75.254456,-75.254543,-75.254632,-75.254738,-75.254937,-75.255112,-75.255267,-75.255409,-75.255543,-75.255686,-75.255812,-75.255852,-75.255892,-75.255966,-75.256083,-75.256193,-75.256281,-75.256383,-75.256586,-75.256686,-75.256746,-75.256816,-75.2569,-75.256981,-75.25711,-75.257129,-75.25725,-75.257319,-75.257418,-75.257487,-75.257543,-75.257629,-75.257705,-75.257788,-75.257858,-75.257933,-75.257994,-75.258014,-75.258012,-75.258014,-75.257991,-75.257962,-75.257944,-75.257944,-75.257976,-75.258007,-75.258058,-75.25812,-75.258189,-75.258271,-75.258339,-75.258407,-75.25847,-75.25851,-75.258547,-75.25859,-75.258637,-75.258684,-75.258706,-75.258713,-75.258715,-75.258711,-75.2587,-75.258709,-75.258738,-75.258767,-75.258797,-75.258839,-75.25889,-75.258974,-75.259078,-75.259214,-75.259333,-75.2594,-75.259423,-75.259427,-75.259428,-75.25945,-75.259551,-75.259649,-75.259779,-75.259909,-75.260065,-75.260309,-75.260491,-75.260584,-75.260662,-75.260751,-75.260828,-75.260932,-75.261026,-75.261115,-75.261161,-75.261215,-75.261284,-75.261386,-75.261445,-75.261479,-75.261547,-75.261661,-75.261736,-75.261811,-75.261893,-75.262013,-75.262093,-75.262104,-75.262116,-75.262138,-75.262153,-75.262169,-75.262242,-75.262265,-75.262277,-75.262342,-75.262382,-75.262422,-75.262457,-75.262512,-75.262559,-75.262618,-75.262679,-75.262766,-75.262836,-75.262919,-75.262961,-75.263028,-75.263092,-75.263144,-75.263195,-75.263251,-75.263307,-75.263383,-75.263467,-75.26353,-75.263614,-75.263696,-75.26377,-75.263855,-75.263928,-75.26399,-75.264016,-75.264056,-75.264131,-75.264242,-75.264373,-75.264496,-75.264553,-75.264644,-75.264758,-75.264918,-75.265058,-75.265252,-75.265388,-75.265448,-75.265528,-75.265566,-75.265598,-75.265656,-75.265744,-75.265806,-75.265858,-75.265921,-75.266048,-75.266062,-75.266193,-75.266313,-75.266395,-75.266545,-75.266707,-75.266795,-75.266909,-75.267024,-75.2671,-75.267138,-75.267214,-75.267245,-75.267386,-75.267475,-75.267538,-75.267598,-75.26767,-75.267779,-75.267818,-75.267909,-75.268129,-75.268393,-75.268461,-75.268513,-75.268568,-75.268701,-75.268773,-75.268846,-75.268916,-75.269016,-75.269044,-75.26908,-75.269125,-75.269157,-75.269206,-75.269272,-75.269357,-75.269445,-75.269498,-75.269548,-75.269614,-75.26967,-75.269741,-75.269801,-75.269857,-75.269919,-75.269961,-75.270002,-75.27003,-75.270054,-75.270073,-75.27014,-75.270192,-75.270297,-75.270388,-75.270402,-75.270413,-75.270422,-75.270447,-75.270501,-75.270522,-75.27057,-75.270598,-75.270651,-75.270718,-75.270773,-75.270838,-75.270913,-75.270986,-75.271043,-75.271109,-75.271168,-75.271241,-75.271327,-75.271407,-75.271491,-75.27159,-75.271698,-75.271802,-75.271863,-75.271922,-75.271985,-75.272024,-75.272086,-75.272196,-75.272344,-75.272505,-75.272625,-75.272726,-75.272815,-75.272957,-75.273054,-75.273185,-75.27328,-75.273415,-75.273492,-75.273569,-75.273681,-75.27381,-75.273912,-75.274012,-75.27415,-75.274326,-75.274488,-75.274808,-75.274889,-75.275027,-75.275084,-75.275197,-75.275266,-75.275322,-75.275362,-75.275394,-75.275456,-75.275494,-75.275567,-75.275606,-75.275652,-75.275705,-75.275819,-75.276005,-75.276186,-75.276245,-75.276277,-75.276302,-75.27637,-75.276411,-75.276438,-75.276467,-75.276508,-75.276553,-75.276611,-75.27664,-75.276656,-75.276667,-75.276674,-75.276662,-75.276636,-75.276587,-75.276528,-75.276471,-75.276485,-75.276524,-75.276583,-75.276689,-75.27676,-75.276825,-75.276896,-75.277073,-75.277136,-75.277198,-75.277266,-75.277338,-75.277421,-75.277491,-75.27754,-75.277576,-75.277611,-75.277656,-75.277687,-75.277704,-75.277713,-75.277688,-75.277646,-75.277596,-75.277551,-75.277523,-75.277509,-75.277503,-75.277505,-75.277513,-75.277529,-75.277553,-75.277591,-75.277641,-75.277676,-75.277765,-75.277886,-75.277967,-75.278018,-75.278297,-75.278352,-75.278449,-75.278537,-75.278609,-75.278657,-75.278697,-75.278703,-75.278724,-75.278759,-75.278777,-75.27878,-75.278784,-75.278795,-75.27881,-75.27883,-75.278859,-75.278916,-75.278952,-75.278971,-75.278998,-75.279046,-75.279081,-75.279109,-75.279123,-75.27917,-75.279242,-75.279359,-75.279465,-75.2796,-75.279805,-75.279955,-75.280027,-75.280044,-75.280085,-75.28013,-75.280192,-75.28023,-75.280266],"lat":[39.974964,39.975349,39.975552,39.975654,39.976041,39.976312,39.976959,39.977127,39.977245,39.977429,39.977512,39.978279,39.978455,39.978512,39.978855,39.979176,39.979275,39.980186,39.980757,39.981014,39.981079,39.981525,39.981832,39.981857,39.982193,39.982356,39.982372,39.982658,39.983045,39.983124,39.98328,39.984241,39.984295,39.984955,39.985073,39.985348,39.985428,39.985527,39.98671,39.986771,39.98719,39.987301,39.987499,39.988304,39.989429,39.989454,39.989504,39.989803,39.990017,39.990116,39.99018,39.989869,39.988016,39.987445,39.987242,39.987039,39.986839,39.986644,39.986456,39.98628,39.986174,39.98611,39.985763,39.98559,39.98542,39.985254,39.985095,39.984942,39.984793,39.98465,39.984511,39.984377,39.984249,39.984124,39.984003,39.983885,39.983769,39.983538,39.983313,39.982871,39.982759,39.982602,39.982382,39.98195,39.981447,39.981283,39.981114,39.980914,39.980424,39.980015,39.979754,39.979415,39.979069,39.978653,39.978423,39.977818,39.977557,39.97728,39.976727,39.976101,39.974553,39.972957,39.971678,39.970141,39.969877,39.96926,39.968977,39.968899,39.967854,39.967913,39.967937,39.967974,39.96801,39.968097,39.968217,39.96834,39.968424,39.9685,39.968583,39.968706,39.968836,39.968967,39.969093,39.968575,39.968697,39.969214,39.969333,39.969349,39.969401,39.96946,39.967937,39.967794,39.967427,39.967115,39.966398,39.966366,39.966326,39.966307,39.966292,39.966299,39.966192,39.966126,39.966051,39.965927,39.964508,39.964452,39.96439,39.964341,39.964305,39.96429,39.964294,39.964315,39.964328,39.964276,39.963044,39.962705,39.962749,39.962808,39.962817,39.96295,39.962992,39.963119,39.963191,39.963249,39.963327,39.963417,39.963528,39.963638,39.963777,39.963876,39.963979,39.964074,39.964352,39.964494,39.964721,39.96485,39.964908,39.964947,39.965001,39.965042,39.965067,39.965076,39.965069,39.965018,39.964948,39.964879,39.964837,39.964833,39.964858,39.964912,39.965003,39.965072,39.965138,39.965192,39.965219,39.965249,39.965302,39.965337,39.965356,39.965346,39.96533,39.965318,39.965305,39.96528,39.965251,39.965244,39.965235,39.965214,39.965184,39.965226,39.965261,39.9653,39.965329,39.96539,39.965402,39.965404,39.965337,39.965273,39.965211,39.965127,39.965046,39.964992,39.964925,39.96485,39.964763,39.964691,39.964655,39.96463,39.964595,39.964546,39.964471,39.964437,39.964372,39.964312,39.964242,39.964155,39.964079,39.963974,39.963802,39.963719,39.963688,39.963677,39.963672,39.963688,39.963719,39.963726,39.963753,39.963767,39.963766,39.963744,39.963705,39.963664,39.963631,39.963602,39.963594,39.963624,39.963677,39.963739,39.963854,39.963993,39.964095,39.964161,39.964236,39.964301,39.964377,39.964399,39.964428,39.964446,39.96445,39.964452,39.964449,39.964452,39.964484,39.964535,39.964618,39.964708,39.964766,39.964846,39.964903,39.964965,39.965059,39.96524,39.965324,39.965378,39.965447,39.965516,39.965571,39.965614,39.965648,39.965676,39.965692,39.965697,39.965698,39.965716,39.965761,39.965813,39.965892,39.965947,39.96601,39.966041,39.966081,39.966115,39.966196,39.966257,39.966313,39.966273,39.966269,39.96628,39.96627,39.966242,39.966198,39.966136,39.966081,39.966026,39.965997,39.966001,39.966031,39.966076,39.966116,39.966159,39.966182,39.96619,39.966171,39.966135,39.966087,39.966054,39.966006,39.965965,39.96595,39.965934,39.96588,39.965858,39.96585,39.965784,39.965739,39.965676,39.965633,39.965611,39.965617,39.965626,39.965638,39.965647,39.965639,39.965609,39.965579,39.965531,39.965486,39.965459,39.965457,39.965474,39.965505,39.965545,39.965577,39.965605,39.965621,39.965614,39.965596,39.965556,39.965529,39.965491,39.965457,39.965421,39.965373,39.965312,39.965242,39.965195,39.965181,39.965179,39.965184,39.965189,39.965192,39.965207,39.965224,39.965257,39.96535,39.965404,39.965448,39.965526,39.965626,39.965716,39.965791,39.96586,39.965926,39.96593,39.965968,39.966004,39.966018,39.966021,39.966021,39.966009,39.966008,39.966025,39.96605,39.966062,39.966092,39.966117,39.966215,39.96626,39.966272,39.966273,39.966298,39.966341,39.966359,39.9664,39.966491,39.966589,39.966618,39.966651,39.966691,39.966796,39.96686,39.966946,39.967041,39.967235,39.967285,39.96733,39.967361,39.967374,39.967381,39.967391,39.967402,39.967388,39.967375,39.967355,39.967331,39.967317,39.967315,39.967326,39.967344,39.96738,39.967425,39.967479,39.967552,39.967653,39.967729,39.967872,39.967977,39.968184,39.968322,39.968357,39.968428,39.968479,39.968528,39.968585,39.968602,39.968638,39.96866,39.968675,39.968671,39.968663,39.968644,39.968619,39.968603,39.968609,39.968619,39.968633,39.968663,39.968691,39.968704,39.968709,39.968715,39.968729,39.968756,39.968805,39.968859,39.968944,39.968985,39.969011,39.969047,39.969094,39.969131,39.969178,39.969217,39.969244,39.969293,39.969305,39.969305,39.969294,39.969281,39.969276,39.969278,39.969287,39.969297,39.96931,39.969315,39.969317,39.969316,39.96931,39.969293,39.969287,39.969289,39.969297,39.969325,39.969364,39.969416,39.969503,39.969575,39.969778,39.969929,39.970125,39.970211,39.970259,39.970293,39.97031,39.970312,39.970324,39.97033,39.970342,39.970351,39.970388,39.970416,39.970468,39.97052,39.97059,39.970672,39.970776,39.970828,39.970862,39.970907,39.970945,39.970983,39.971016,39.971056,39.971095,39.971135,39.971178,39.971224,39.971262,39.971253,39.971244,39.971215,39.971175,39.971105,39.971089,39.971082,39.971082,39.971083,39.971097,39.97111,39.971127,39.97115,39.971175,39.971209,39.971247,39.971284,39.971321,39.971345,39.971362,39.971377,39.971386,39.971401,39.971424,39.971452,39.971487,39.971518,39.971555,39.971583,39.971615,39.971643,39.971659,39.971678,39.971693,39.971714,39.971751,39.971928,39.972013,39.972106,39.972185,39.972263,39.972332,39.972414,39.972442,39.97253,39.972634,39.972692,39.972745,39.972841,39.97295,39.973051,39.973162,39.973247,39.973315,39.973359,39.973446,39.973526,39.973618,39.973691,39.973812,39.973913,39.973986,39.974031,39.974072,39.974122,39.974185,39.97432,39.974424,39.974502,39.97454,39.974624,39.974735,39.974835,39.974888,39.974964]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,"ZCTA: 19151",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[39.962705,39.99018],"lng":[-75.280266,-75.23724]}},"evals":[],"jsHooks":[]}</script>
<p>Indeed the map shows that we have correctly matched coordinate to ZCTA. Moreover, if you hover over the polygon you can see that the ZCTA matches the ZCTA_origin of the point. Now since we want to iterate this process over many points. Lets turn the above process into a function.</p>
<pre class="r"><code>get_zcta_from_coord = function(row_tmp){
  df_coord_row = df_coord %&gt;% slice(row_tmp)
 
  ### Make a  point object
  pt_tmp = st_point(x = c(df_coord_row$longitude, df_coord_row$latitude), dim = &quot;XYZ&quot;)
  ### see which polygon/row of sf_zcta_philly this point intersects with
  intersection_row_tmp = st_intersects(pt_tmp,sf_zcta_philly)[[1]]
  sf_zcta_tmp = sf_zcta_philly %&gt;% slice(intersection_row_tmp)
  zcta_tmp = sf_zcta_tmp$ZCTA5CE10
  ### Return table with id and matched zcta
  tibble(id = df_coord_row$id, 
         zcta_matched = zcta_tmp)
}</code></pre>
</div>
<div id="step-3-repeat-process-for-each-coordinate" class="section level1">
<h1>Step 3: Repeat process for each coordinate</h1>
<p>The next step is to iterate or loop over each coordiante we want to find ZCTA’s for. We will use a functional programming approach with the map() from purrr as it makes iterating much easier. So we will pass in a vector of numbers 1 to number of rows in df_coord. Then we will run get_zcta_from_coord() for each coord or row in df_coord. With one line of code we can get the final result.</p>
<pre class="r"><code>df_results = map_df(1:nrow(df_coord),get_zcta_from_coord)
df_results %&gt;% kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="left">zcta_matched</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">19151</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">19123</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">19103</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">19136</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">19127</td>
</tr>
</tbody>
</table>
<p>Lets check the final result with our answers aka zcta_origin</p>
<pre class="r"><code>df_results %&gt;%
  left_join(df_coord %&gt;% select(id, zcta_origin)) %&gt;% 
  kable()</code></pre>
<pre><code>## Joining, by = &quot;id&quot;</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="left">zcta_matched</th>
<th align="left">zcta_origin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">19151</td>
<td align="left">19151</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">19123</td>
<td align="left">19123</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">19103</td>
<td align="left">19103</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">19136</td>
<td align="left">19136</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">19127</td>
<td align="left">19127</td>
</tr>
</tbody>
</table>
<p>The ZCTAs that we matched with our function indeed match the original ZCTA. = ) :smile: :taco:</p>
</div>
